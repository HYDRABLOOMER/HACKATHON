<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>User Dashboard - EcoQuest</title>

    <link rel="stylesheet" href="../css/main.css" />

    <script
      type="module"
      async
      src="https://static.rocket.new/rocket-web.js?_cfg=https%3A%2F%2Fecoquest4652back.builtwithrocket.new&_be=https%3A%2F%2Fapplication.rocket.new&_v=0.1.12"
    ></script>
    <script
      type="module"
      defer
      src="https://static.rocket.new/rocket-shot.js?v=0.0.2"
    ></script>
  </head>

  <body class="bg-background">
    <!-- ================= HEADER ================= -->
    <header class="bg-surface border-b border-border-surface sticky top-0 z-100">
      <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex items-center justify-between h-16">
          <!-- Logo -->
          <div class="flex items-center space-x-3">
            <span class="text-2xl font-heading font-bold text-primary">
              EcoQuest
            </span>
          </div>

          <!-- Desktop Nav -->
          <div class="hidden md:flex items-center space-x-1">
            <a
              href="user_dashboard"
              class="px-4 py-2 rounded-lg bg-primary-50 text-primary font-medium"
              >Dashboard</a
            >
            <a href="knowledge_quiz" class="px-4 py-2 rounded-lg"
              >Quiz</a
            >
            <a href="eco_tasks" class="px-4 py-2 rounded-lg">Tasks</a>
            <a href="community_issues" class="px-4 py-2 rounded-lg"
              >Community</a
            >
            <a href="leaderboards" class="px-4 py-2 rounded-lg"
              >Leaderboards</a
            >
          </div>

          <!-- User -->
          <div class="flex items-center space-x-3">
            <span
              id="navUserName"
              class="text-sm font-medium text-text-primary"
            ></span>
          </div>
        </div>
      </nav>
    </header>

    <!-- ================= MAIN ================= -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <!-- Welcome -->
      <div class="mb-8">
        <h1 class="text-4xl font-heading font-bold text-text-primary mb-2">
          Welcome back, <span id="welcomeUser">User</span> ðŸŒ±
        </h1>
        <p class="text-text-secondary">
          Start your sustainability journey today
        </p>
      </div>


      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <div class="card">
          <p class="text-sm text-text-secondary">Total EcoPoints</p>
          <h3 id="ecoPoints" class="text-3xl font-bold">0</h3>
        </div>

        <div class="card">
          <p class="text-sm text-text-secondary">Daily Streak</p>
          <h3 id="dailyStreak" class="text-3xl font-bold">0 Days</h3>
        </div>

        <div class="card">
          <p class="text-sm text-text-secondary">Weekly Rank</p>
          <h3 id="weeklyRank" class="text-3xl font-bold">â€”</h3>
        </div>

        <div class="card">
          <p class="text-sm text-text-secondary">Achievements</p>
          <h3 id="achievements" class="text-3xl font-bold">0</h3>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- LEFT -->
        <div class="lg:col-span-2 space-y-6">
          <!-- Recent Activity -->
          <div class="card">
            <h2 class="text-2xl font-heading font-semibold mb-4">
              Recent Activity
            </h2>
            <div
              id="activityFeed"
              class="text-text-secondary text-sm"
            >
              No activity yet. Complete a quiz or task to get started.
            </div>
          </div>

          <!-- Monthly Impact -->
          <div class="card">
            <h2 class="text-2xl font-heading font-semibold mb-4">
              Monthly Impact
            </h2>

            <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
              <div class="text-center">
                <div id="monthlyQuizzes" class="text-2xl font-bold">0</div>
                <p class="text-sm text-text-secondary">Quizzes</p>
              </div>
              <div class="text-center">
                <div id="monthlyTasks" class="text-2xl font-bold">0</div>
                <p class="text-sm text-text-secondary">Tasks</p>
              </div>
              <div class="text-center">
                <div id="monthlyPosts" class="text-2xl font-bold">0</div>
                <p class="text-sm text-text-secondary">Posts</p>
              </div>
              <div class="text-center">
                <div id="monthlyBadges" class="text-2xl font-bold">0</div>
                <p class="text-sm text-text-secondary">Badges</p>
              </div>
            </div>
          </div>
        </div>

        <!-- RIGHT -->
        <div class="space-y-6">
          <!-- Leaderboard -->
          <div class="card">
            <h2 class="text-xl font-heading font-semibold mb-4">
              Leaderboard
            </h2>
            <p class="text-text-secondary text-sm">
              You are not ranked yet. Start earning EcoPoints!
            </p>
          </div>

          <!-- Notifications -->
          <div class="card">
            <h2 class="text-xl font-heading font-semibold mb-4">
              Notifications
            </h2>
            <p class="text-text-secondary text-sm">
              No notifications right now.
            </p>
          </div>
        </div>
      </div>
    </main>

    <script>
      async function loadDashboard() {
        try {
          const res = await fetch("/api/users/me", {
            credentials: "include",
          });

          if (!res.ok) throw new Error("Unauthorized");

          const user = await res.json();

          document.getElementById("navUserName").innerText = user.name;
          document.getElementById("welcomeUser").innerText = user.name;

          document.getElementById("ecoPoints").innerText =
            user.ecoPoints || 0;
          document.getElementById("dailyStreak").innerText =
            (user.streak || 0) + " Days";

          document.getElementById("weeklyRank").innerText =
            user.rank ? "#" + user.rank : "â€”";
        } catch (err) {
          window.location.href = "/";
        }
      }

      loadDashboard();
    </script>
  </body>
</html>
